---
title: "ainsel weather"
author: "Ainsel Levitskaia-Collins, HL2710"
date: "2025-11-18"
output: github_document
---

```{r include = FALSE}
library(tidyverse)
```

### Initial Setup

Importing Data:

```{r message = FALSE, warning = FALSE}
shooting_h <- read_csv("./Data Folder/Shooting_Historic.csv") %>% 
  janitor::clean_names()

shooting_2025 <- read_csv("./Data Folder/Shooting_2025.csv") %>% 
  janitor::clean_names() %>% 
  mutate(statistical_murder_flag = case_match(statistical_murder_flag,
                                             "N" ~ FALSE,
                                             "Y" ~ TRUE))

weather <- read_csv("./Data Folder/Weather.csv") %>% 
  janitor::clean_names()

holidays <- readxl::read_excel("./Data Folder/Holidays.xlsx")
```

Merge & tidy shooting data:

```{r}
shooting <- bind_rows(shooting_2025, shooting_h) %>% 
  separate_wider_delim(occur_date, delim = "/", names_sep = ".") %>% 
  rename(
    month = occur_date.1,
    day = occur_date.2,
    year = occur_date.3,
    time = occur_time
  ) %>% 
  mutate(
    month = case_match(month,
      "01" ~ "January",
      "02" ~ "February",
      "03" ~ "March",
      "04" ~ "April",
      "05" ~ "May",
      "06" ~ "June",
      "07" ~ "July",
      "08" ~ "August",
      "09" ~ "September",
      "10" ~ "October",
      "11" ~ "November",
      "12" ~ "December"),
    day = as.numeric(day),
    year = as.numeric(year)) %>% 
  distinct(incident_key, .keep_all = TRUE) %>% 
  filter(boro == "MANHATTAN")
```



### Weather Analysis

Tidy weather data:

```{r}
weather <- weather %>% 
  separate_wider_delim(date, delim = "-", names_sep = "_") %>% 
  rename(
    year = date_1,
    month = date_2,
    day = date_3
  ) %>% 
  mutate(
    month = case_match(month,
      "01" ~ "January",
      "02" ~ "February",
      "03" ~ "March",
      "04" ~ "April",
      "05" ~ "May",
      "06" ~ "June",
      "07" ~ "July",
      "08" ~ "August",
      "09" ~ "September",
      "10" ~ "October",
      "11" ~ "November",
      "12" ~ "December"),
    day = as.numeric(day),
    year = as.numeric(year)) %>% 
  filter(year >= 2006) %>% 
  select(name, month, day, year, prcp, prcp_attributes, tmax, tmin, latitude, longitude)
```

Merge with shooting data:

```{r}
# OBSOLETE?
# shooting_weather <- full_join(shooting, weather, by = c("month", "day", "year")) %>% 
  # mutate(
    # shooting = incident_key > 0,
    # shooting = case_match(shooting,
                          # TRUE ~ "Incident",
                          # NA ~ "No Incident")
  # )

weather_shooting <- left_join(weather, shooting, by = c("month", "day", "year")) %>% 
  group_by(year, month, day) %>% 
  slice_head() %>% 
  ungroup() %>% 
  mutate(
    shooting = incident_key > 0,
    shooting = case_match(shooting,
                          TRUE ~ "Incident",
                          NA ~ "No Incident")
  )
```

Plot of max/min temperature and whether there was a shooting:

```{r message = FALSE}
plot_temp_shooting <- weather_shooting %>% 
  arrange(desc(shooting)) %>% 
  ggplot(aes(x = tmin, y = tmax, color = shooting)) +
  geom_point() +
  scale_color_manual(values = c("violetred4", "lightsteelblue3")) +
  theme_minimal() +
  xlab("Minimum daily temperature (tenths of degrees C)") +
  ylab("Maximum daily temperature (tenths of degrees C)") +
  ggtitle("Shooting incidence compared against daily temperature")

plot_temp_shooting
```

No visible correlation between temperature and shooting incidence.

#### TEST statistical test to confirm this?

Plot of precipitation and whether there was a shooting:

```{r message = FALSE}
plot_prcp_low_shooting <- weather_shooting %>% 
  filter(prcp < 400) %>% 
  ggplot(aes(x = prcp, color = shooting, fill = shooting)) + 
  geom_histogram() +
  scale_color_manual(values = c("violetred4", "lightsteelblue3")) +
  scale_fill_manual(values = c("violetred4", "lightsteelblue3")) +
  theme_minimal() +
  xlab("Precipitation (tenths of mm)") +
  ylab("") +
  ggtitle("Shooting count in low precipitation")

plot_prcp_low_shooting

plot_prcp_high_shooting <- weather_shooting %>% 
  filter(prcp > 400) %>% 
  ggplot(aes(x = prcp, color = shooting, fill = shooting)) + 
  geom_histogram() +
  scale_color_manual(values = c("violetred4", "lightsteelblue3")) +
  scale_fill_manual(values = c("violetred4", "lightsteelblue3")) +
  theme_minimal() +
  ylab("") +
  xlab("Precipitation (tenths of mm)") +
  ggtitle("Shooting count in high precipitation")

plot_prcp_high_shooting
```

There appears to be a higher quantity of shootings during lower-precipitation days, however it's difficult to tell whether this is correlative or not. 

Plot of yes/no precipitation:

```{r}
plot_prcp_yesno <- weather_shooting %>% 
  mutate(any_prcp = prcp > 0,
         any_prcp = case_match(any_prcp,
                               TRUE ~ "Precipitation",
                               FALSE ~ "No Precipitation")) %>% 
  ggplot(aes(x = any_prcp, fill = shooting)) +
  geom_bar(position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("violetred4", "lightsteelblue3")) +
  xlab("") +
  ylab("Total Number of Days")

plot_prcp_yesno
```

After converting precipitation to a binary variable, there does not appear to be any visible association between whether there was a shooting & whether there was any precipitation that day.

#### TEST ttest to confirm lack of association



### Holiday Analysis

Tidy holiday data:

```{r}
holidays <- holidays %>% 
  pivot_longer(`2025`:`2006`, names_to = "year", values_to = "date") %>% 
  separate_wider_delim(date, delim = "/", names_sep = "_") %>% 
  rename(
    month = date_1,
    day = date_2
  ) %>% 
  mutate(
    month = case_match(month,
      "1" ~ "January",
      "2" ~ "February",
      "3" ~ "March",
      "4" ~ "April",
      "5" ~ "May",
      "6" ~ "June",
      "7" ~ "July",
      "8" ~ "August",
      "9" ~ "September",
      "10" ~ "October",
      "11" ~ "November",
      "12" ~ "December"),
    day = as.numeric(day),
    year = as.numeric(year))
```

Merge with shooting data:

```{r}
# OBSOLETE?
# shooting_holidays <- full_join(shooting, holidays, by = c("month", "day", "year")) %>% 
  # mutate(
    # shooting = incident_key > 0,
    # shooting = case_match(shooting,
                          # TRUE ~ "Incident",
                          # NA ~ "No Incident"),
    # holiday_yn = is.na(holiday),
    # holiday_yn = case_match(holiday_yn,
                            # TRUE ~ "No Holiday",
                            # FALSE ~ "Holiday"))

holiday_shooting <- left_join(weather, holidays, by = c("month", "day", "year")) %>% 
  select(month, day, year, holiday) %>% 
  mutate(holiday = replace_na(holiday, "No Holiday"))

holiday_shooting <- left_join(holiday_shooting, shooting, by = c("month", "day", "year")) %>% 
  group_by(year, month, day) %>% 
  slice_head() %>% 
  ungroup() %>% 
  mutate(
    shooting = incident_key > 0,
    shooting = case_match(shooting,
                          TRUE ~ "Incident",
                          NA ~ "No Incident"),
    holiday_yn = holiday != "No Holiday",
    holiday_yn = case_match(holiday_yn,
                            FALSE ~ "No Holiday",
                            TRUE ~ "Holiday")
  )
```

Plot of yes vs no holiday:

```{r}
plot_holiday_yn <- holiday_shooting %>% 
  ggplot(aes(x = holiday_yn, fill = shooting)) +
  geom_bar(position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("violetred4", "lightsteelblue3")) +
  xlab("") +
  ylab("Total Number of Days")

plot_holiday_yn
```

Plot of individual holidays vs no holiday:

#### TODO fix order of holiday variables (factor?)

```{r}
plot_holiday_i <- holiday_shooting %>% 
  ggplot(aes(x = holiday, fill = shooting)) +
  geom_bar(position = position_dodge()) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  scale_fill_manual(values = c("violetred4", "lightsteelblue3")) +
  xlab("") +
  ylab("Total number of days")

plot_holiday_i
```

It seems that there's a trend of more shootings happening on non-holiday days than on holiday days. Will need to do further testing to confirm whether this is a significant association.

#### TEST test the significance of this, ttest for yes/no holiday, unsure for other holidays. linear regression, probably?



### COVID Analysis

Plot of per-year shooting incidence:

```{r}
plot_covid_yearly <- shooting %>% 
  ggplot(aes(x = year)) +
  geom_histogram(bins = 19, color = "violetred4", fill = "violetred4") +
  theme_minimal() +
  ylab("Number of Shootings") +
  xlab("Year")

plot_covid_yearly
```

There appears to be a decrease leading to 2020, and then a spike at 2020.

Create variable for whether or not shooting takes place during COVID-19 pandemic :

- Based on WHO dates for when the pandemic began and ended:
  - March 11, 2020: start of pandemic
  - May 5, 2023: end of pandemic

#### TODO fix the stupid `case_when` thing

```{r eval = FALSE}
# march 11 2020: declared pandemic by WHO
# may 5 2023: end of pandemic declared by WHO

pandemic_shooting <- left_join(weather, shooting, by = c("month", "day", "year")) %>% 
  select(-c(name, prcp, prcp_attributes, tmax, tmin, latitude.x, longitude.x)) %>% 
  group_by(year, month, day) %>% 
  slice_head() %>% 
  ungroup() %>% 
  mutate(
    shooting = incident_key > 0,
    shooting = case_match(shooting,
                          TRUE ~ "Incident",
                          NA ~ "No Incident"),
    month = case_match(month,
                       "January" ~ 1,
                       "February" ~ 2,
                       "March" ~ 3,
                       "April" ~ 4,
                       "May" ~ 5,
                       "June" ~ 6,
                       "July" ~ 7,
                       "August" ~ 8,
                       "September" ~ 9,
                       "October" ~ 10,
                       "November" ~ 11,
                       "December" ~ 12),
    covid = case_when(
      year = 2021 ~ TRUE,
      year = 2022 ~ TRUE,
      year = 2020 & month > 3 ~ TRUE,
      year = 2020 & month = 3 & day >= 11 ~ TRUE,
      year = 2023 & month < 5 ~ TRUE,
      year = 2023 $ month = 5 & day <= 5 ~ TRUE,
      .default = FALSE
    ),
    covid = case_match(covid,
                       TRUE ~ "During Covid",
                       FALSE ~ "Not During Covid"),
    month = case_match(month,
                       1 ~ "January",
                       2 ~ "February",
                       3 ~ "March",
                       4 ~ "April",
                       5 ~ "May",
                       6 ~ "June",
                       7 ~ "July",
                       8 ~ "August",
                       9 ~ "September",
                       10 ~ "October",
                       11 ~ "November",
                       12 ~ "December")
    )
```

Plot of yes/no COVID-19 shooting (NOT counts):

```{r}

```



### Time of Day Analysis

Create variable for day/night:

```{r}

```

Plot of day/night shootings:

```{r}

```

Plot of shootings per hour of the day:

```{r}

```



### Day of Week Analysis

Tidy day of week data:

```{r}

```

Plot of all weekdays:

```{r}

```

Plot of weekends vs week days:

```{r}

```

